
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Gerbil Assembler</title>

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="cover.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <div class="container">

      <div class="page-header">
        <h1 class="cover-heading">Gerbil Assembler</h1>
        <p class="lead">This page helps You assemble the data collector script for the clients and lets You test it on this page. If the server backend is already up and runing with the given wsid, the requests are collected </p>
        <h4>Gerbil URL</h4>
        <textarea name="gerbilurl" value="sdfasdf" style="width: 100%; height: 80px;" onclick="this.focus();this.select()" readonly="readonly"></textarea>
      </div>

      <div class="row">
        <div class="col-md-3">
          <h2 class="cover-heading">Gerbil Version</h2>
          <select name="version" size="4" style="width: 98%">
          <option selected="selected" value="2.1.6">v2.1.6 (Latest)</option>
            <option value="2.0.1">v2.0.1</option>
          </select>
          <hr>
          <h2 class="cover-heading">Macro Templates</h2>
          <select name="template" size="4" style="width: 98%">
            <option selected="selected" value="default">Default</option>
            <option value="gemius">Gemius</option>
            <option value="appnexus">AppNexus</option>
          </select>
          <hr>
          <p>
            <button id="update">Update URL</button>
          </p>
          <p>
            <button id="test">Test Gerbil</button>
          </p>
        </div>
        <div class="col-md-9">
            <h2 class="cover-heading">Gerbil Macros</h2>
            <p>Fields in bold are mandatory</p>
            <table id="gerbil-vars" class="table table-striped">
              <thead>
                <tr>
                  <th style="width: 20%">Gerbil variable</th>
                  <th style="width: 30%">Macro</th>
                  <th style="width: 50%">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>WSID</b></td>
                  <td><input class="param" name="wsid" type="text" /></td>
                  <td>Client ID</td>
                </tr>
                <tr>
                  <td>BANH</td>
                  <td><input class="param" name="banh" type="text" value="0"/></td>
                  <td>Banner height</td>
                </tr>
                <tr>
                  <td>BANW</td>
                  <td><input class="param" name="banw" type="text" value="0"/></td>
                  <td>Banner width</td>
                </tr>
                <tr>
                  <td>SID</td>
                  <td><input class="param" name="sid" type="text" /></td>
                  <td>Session ID</td>
                </tr>
                <tr>
                  <td>IID</td>
                  <td><input class="param" name="iid" type="text" /></td>
                  <td>Impression ID</td>
                </tr>
                <tr>
                  <td>PID</td>
                  <td><input class="param" name="pid" type="text" /></td>
                  <td>Partner ID</td>
                </tr>
                <tr>
                  <td>PURL</td>
                  <td><input class="param" name="purl" type="text" /></td>
                  <td>Partner URL</td>
                </tr>
                <tr>
                  <td>AID</td>
                  <td><input class="param" name="aid" type="text" /></td>
                  <td>Advertiser ID</td>
                </tr>
                <tr>
                  <td>ADID</td>
                  <td><input class="param" name="adid" type="text" /></td>
                  <td>Ad ID</td>
                </tr>
                <tr>
                  <td>ZID</td>
                  <td><input class="param" name="zid" type="text" /></td>
                  <td>Zone ID</td>
                </tr>
                <tr>
                  <td>CID</td>
                  <td><input class="param" name="cid" type="text" /></td>
                  <td>Channel ID</td>
                </tr>
                <tr>
                  <td>CURL</td>
                  <td><input class="param" name="curl" type="text" /></td>
                  <td>Channel URL</td>
                </tr>
              </tbody>
            </table>
        </div>
      </div>
    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.1/bootstrap-table-all.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="http://getbootstrap.com/assets/js/ie10-viewport-bug-workaround.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){

        var can_test = false;

        function assemble(){
          console.log($("input[name=wsid]").val());
          if ($("input[name=wsid]").val() != "") {
            var RACKCDN_URL = "https://df3a34acb7eb1321d99f-2366b89f86f9049a8d564854bcebe54e.ssl.cf5.rackcdn.com/gerbil-";
            var gerbil_version = $("select[name=version]").val();
            var gerbil_url = RACKCDN_URL + gerbil_version + ".js?";
            var query_string = [];
            $(".param").each(function(index){
              console.log($(this).attr('name'), $(this).val());
              if ($(this).val()) {
                query_string.push($(this).attr('name') + '=' + $(this).val());
              }
            });
            query_string = query_string.join("&");
            var gerbil_url = gerbil_url + query_string;
            $("textarea[name=gerbilurl]").val(gerbil_url);
            can_test = true;
          }
          else {
            $("textarea[name=gerbilurl]").val("Fill WSID field");
            can_test = false;
          }
        }

        function test(){
          if (can_test) {
            var gerbil_url = encodeURIComponent($("textarea[name=gerbilurl]").val());
            window.open("test.html#"+gerbil_url);
          }
        }

        function get_macro_template(template_name){
          console.log("Getting template for:", template_name);
          var macro_template;
          switch (template_name){
            // MACRO list: https://docs.zoho.com/ws/crm/file/9de9db7ff666b1e074762ac9ce4b87d7c2dd6
            // enviroment.sid  = enviroment.sid    || params.n    || params.sid         || default_sid;
            // enviroment.iid  = enviroment.iid    || params.n    || params.iid         || default_iid;
            // enviroment.pid  = enviroment.pid    || params.esid || params.pid         || 'NAN';
            // enviroment.purl = enviroment.purl   || params.s    || params.purl        || 'NAN';
            // enviroment.aid  = enviroment.aid    || params.eiad || params.aid         || 'NAN';
            // enviroment.adid = enviroment.adid   || params.eadv || params.adid        || 'NAN';
            // enviroment.zid  = enviroment.zid    || params.epid || params.zid         || 'NAN';
            // enviroment.cid  = enviroment.cid    || params.ebuy || params.cid         || 'NAN';
            // enviroment.curl = enviroment.curl   || params.eenv || params.curl        || 'NAN';
            case "appnexus":
              macro_template = {
                banh: '${HEIGHT}',
                banw: '${WIDTH}',
                sid: '',
                iid: '${AUCTION_ID}',
                pid: '${SITE_ID}',
                purl: '${SOURCE_URL}',
                aid: '${IO_ID}',
                adid: '${ADV_ID}',
                zid: '${PUBLISHER_ID}',
                cid: '${INV_SOURCE_ID}',
                curl: '',
              }
              break;
            case "gemius":
              macro_template = {
                banh: 0,
                banw: 0,
                sid: '',
                iid: '',
                pid: '',
                purl: '',
                aid: '',
                adid: '',
                zid: '',
                cid: '',
                curl: '',
              }
              break;
            default:
              macro_template = {
                banh: 0,
                banw: 0,
                sid: '',
                iid: '',
                pid: '',
                purl: '',
                aid: '',
                adid: '',
                zid: '',
                cid: '',
                curl: '',
              }
              break;
          }
          return macro_template;
        }

        function apply_macro_template(macro_template){
          for (var macroname in macro_template){
            console.log(macroname, macro_template[macroname]);
            var macro_value = macro_template[macroname];
            $(".param[name="+macroname+"]").val(macro_value);
          }
        }

        $("#update").click(assemble);
        $("#test").click(test);
        $("select[name=template]").change(function(i){
          var v2 = $(this).val();
          var macro = get_macro_template(v2);
          apply_macro_template(macro);
        });
      });
    </script>
  </body>
</html>
